<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yard View</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 기본 스타일 */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
        }

        .main-content {
            flex: 1;
            {% comment %} margin-left: 180px;  /* nav.html의 정확한 너비만큼 */ {% endcomment %}
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .yard-layout {
            flex: 1;
            position: relative;
            border: 1px solid #e9ecef;  /* 네비바와 어울리는 테두리 색상 */
            margin: 10px 0;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);  /* 그림자 효과 수정 */
            min-height: 500px;
            border-radius: 8px;
        }

        .top-nav {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: white;
            border: 1px solid #e9ecef;
            height: 150px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border-radius: 8px;
        }

        .nav-select {
            padding: 8px 15px;
            border: 1px solid #e9ecef;
            font-size: 13px;
            cursor: pointer;
            border-radius: 5px;
            background: white;
            color: #2c3e50;
        }

        .nav-select:hover {
            border-color: #1abc9c;
        }

        .timeline {
            margin-right: auto;
            margin-left: 20px;
            padding: 8px;
            border: 1px solid #e9ecef;
            font-size: 13px;
            width: 400px;
            height: 100px;
            overflow-y: scroll;
            position: relative;
            border-radius: 5px;
            background: white;
        }

        .timeline div {
            padding: 5px 8px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .timeline div:hover {
            background: #f8f9fa;
            color: #1abc9c;
        }

        .expand-button {
            position: absolute;
            right: 5px;
            bottom: 5px;
            width: 20px;
            height: 20px;
            background: #1abc9c;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .expand-button:hover {
            background: #16a085;
            transform: scale(1.1);
        }

        .left-area {
            position: absolute;
            left: 20px;
            top: 20px;
            bottom: 20px;
            width: calc(50% - 40px);
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }

        .right-area {
            position: absolute;
            right: 20px;
            top: 20px;
            bottom: 20px;
            width: calc(50% - 40px);
            border-radius: 8px;
        }

        .container-area {
            position: absolute;
            right: 0;
            top: 0;
            width: 100%;
            height: 200px;
            border: 1px solid #e9ecef;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 1px;
            background: #f8f9fa;
            padding: 1px;
            border-radius: 8px;
        }

        .bottom-sectors {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 100%;
            display: flex;
            gap: 20px;
        }

        .trailer-area {
            width: 30%;
            height: 100px;
            border: 1px solid #e9ecef;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 1px;
            background: #f8f9fa;
            padding: 1px;
            position: relative;
            border-radius: 8px;
        }

        .chassis-area {
            flex-grow: 1;
            height: 100px;
            border: 1px solid #e9ecef;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 1px;
            background: #f8f9fa;
            padding: 1px;
            position: relative;
            border-radius: 8px;
        }

        .grid-cell {
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c3e50;
            font-size: 13px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .grid-cell.occupied {
            background: #1abc9c;
            color: white;
            cursor: pointer;
        }

        .grid-cell.occupied:hover {
            background: #16a085;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sector-title {
            position: absolute;
            top: -25px;
            left: 0;
            font-size: 13px;
            font-weight: 500;
            color: #2c3e50;
            background: white;
            padding: 4px 12px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            z-index: 1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        /* 주차 공간 전체를 감싸는 영역 */
        .parking-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 90%;
            height: 95%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
        }

        /* 상단/하단 행 스타일 */
        .parking-row {
            display: flex;
            justify-content: space-between;
            height: 30%;
        }

        /* 상단 행은 위쪽에 정렬 */
        .parking-row:first-child {
            align-items: flex-start;
        }

        /* 하단 행은 아래쪽에 정렬 */
        .parking-row:last-child {
            align-items: flex-end;
        }

        /* 세로 방향 주차 공간 열 */
        .parking-column {
            display: flex;
            flex-direction: column;
            width: 70px;
        }

        /* 가로 방향 주차 공간 열 (중앙 부분) */
        .parking-column2 {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin: 0 auto;
        }

        /* 세로 방향 주차 공간 */
        .parking-space {
            width: 60px;
            height: 40px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c3e50;
            font-size: 13px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border-radius: 5px;
            transition: all 0.2s ease;
        }

        /* 가로 방향 주차 공간 */
        .parking-space2 {
            width: 40px;
            height: 60px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c3e50;
            font-size: 13px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border-radius: 5px;
            transition: all 0.2s ease;
        }

        /* 점유된 주차 공간 스타일 */
        .parking-space.occupied, .parking-space2.occupied {
            background: #1abc9c;
            color: white;
            cursor: pointer;
        }

        .parking-space.occupied:hover, .parking-space2.occupied:hover {
            background: #16a085;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 24px;
            border-radius: 8px;
            min-width: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .close-btn {
            position: absolute;
            right: 15px;
            top: 15px;
            cursor: pointer;
            font-size: 20px;
            color: #2c3e50;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            color: #1abc9c;
        }

        .modal-body {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 20px;
        }

        .equipment-image {
            width: 150px;
            height: 150px;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .equipment-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .info-row {
            display: flex;
            gap: 12px;
        }

        .info-label {
            font-weight: 500;
            min-width: 100px;
            color: #2c3e50;
        }

        .info-value {
            color: #1abc9c;
        }

        /* 타임라인 모달 스타일 */
        .timeline-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .timeline-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 24px;
            border-radius: 8px;
            width: 600px;
            max-height: 80vh;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .timeline-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .timeline-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .timeline-close-btn {
            cursor: pointer;
            font-size: 20px;
            color: #2c3e50;
            transition: all 0.2s ease;
        }

        .timeline-close-btn:hover {
            color: #1abc9c;
        }

        .timeline-list {
            max-height: calc(80vh - 100px);
            overflow-y: auto;
        }

        .current-time {
            font-family: -apple-system;
            font-size: 14px;
            font-weight: 500;
            color: #2c3e50;
            padding: 8px 15px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            margin-left: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .date-picker {
            font-family: -apple-system;
            font-size: 14px;
            padding: 7px 12px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            color: #2c3e50;
            cursor: pointer;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .date-picker:hover {
            border-color: #1abc9c;
        }

        /* 반응형 스타일 */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 16px;
                padding-bottom: 80px;
            }

            .container {
                padding: 16px;
            }

            .modal-content {
                width: 90%;
                min-width: auto;
                margin: 0 16px;
            }

            .timeline-modal-content {
                width: 90%;
                margin: 0 16px;
            }

            .timeline {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    {% include 'nav.html' %}
    <div class="container">
        <div class="main-content">
            <div class="top-nav">
                <select class="nav-select" id="division-select" onchange="updateDivision()">
                    <option value="LA" selected>LA</option>
                    <option value="PHX">PHX</option>
                    <option value="HOU">HOU</option>
                    <option value="SAV">SAV</option>
                    <option value="MOB">MOB</option>
                </select>
                <select class="nav-select" id="yard-select" onchange="updateYard()">
                    <option value="" disabled selected>Select a yard</option>
                </select>
                <div class="timeline" id="transactions">
                    {% comment %} <div>20:17 / AAAA00 / IN / JASON</div>
                    <div>17:13 / AAAD48/ OUT / PANWOO</div>
                    <div>15:10 / AABC07 / IN / MIKE</div>
                    <div>14:05 / ABCD10 / OUT / JOHN</div>
                    <div>13:00 / BCDD32 / IN / SARAH</div>
                    <button class="expand-button">+</button> {% endcomment %}
                </div>
                <input type="date" id="date-picker" class="date-picker">
                <div id="current-time" class="current-time"></div>
            </div>
    
            <div class="yard-layout">
                <div class="left-area">
                    <div class="sector-title">TRUCK (<span class="total">30</span>/<span class="occupied-count">0</span>)</div>
                    <div class="parking-area">
                        <div class="parking-row">
                            <div class="parking-column">
                                <div class="parking-space" id="truck-space-position1"></div>
                                <div class="parking-space" id="truck-space-position2"></div>
                                <div class="parking-space" id="truck-space-position3"></div>
                                <div class="parking-space" id="truck-space-position4"></div>
                                <div class="parking-space" id="truck-space-position5"></div>
                            </div>
                            <div class="parking-column2">
                                <div class="parking-space2" id="truck-space-position6"></div>
                                <div class="parking-space2" id="truck-space-position7"></div>
                                <div class="parking-space2" id="truck-space-position8"></div>
                                <div class="parking-space2" id="truck-space-position9"></div>
                                <div class="parking-space2" id="truck-space-position10"></div>
                            </div>
                            <div class="parking-column">
                                <div class="parking-space" id="truck-space-position11"></div>
                                <div class="parking-space" id="truck-space-position12"></div>
                                <div class="parking-space" id="truck-space-position13"></div>
                                <div class="parking-space" id="truck-space-position14"></div>
                                <div class="parking-space" id="truck-space-position15"></div>
                            </div>
                        </div>
                        <div class="parking-row">
                            <div class="parking-column">
                                <div class="parking-space" id="truck-space-position16"></div>
                                <div class="parking-space" id="truck-space-position17"></div>
                                <div class="parking-space" id="truck-space-position18"></div>
                                <div class="parking-space" id="truck-space-position19"></div>
                                <div class="parking-space" id="truck-space-position20"></div>
                            </div>
                            <div class="parking-column2">
                                <div class="parking-space2" id="truck-space-position21"></div>
                                <div class="parking-space2" id="truck-space-position22"></div>
                                <div class="parking-space2" id="truck-space-position23"></div>
                                <div class="parking-space2" id="truck-space-position24"></div>
                                <div class="parking-space2" id="truck-space-position25"></div>
                            </div>
                            <div class="parking-column">
                                <div class="parking-space" id="truck-space-position26"></div>
                                <div class="parking-space" id="truck-space-position27"></div>
                                <div class="parking-space" id="truck-space-position28"></div>
                                <div class="parking-space" id="truck-space-position29"></div>
                                <div class="parking-space" id="truck-space-position30"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="right-area">
                    <!-- Container Area -->
                    <div class="container-area">
                        <div class="sector-title">CONTAINER (<span class="total">40</span>/<span class="occupied-count">0</span>)</div>
                        <div class="parking-area">
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position1"></div>
                                <div class="parking-space" id="container-space-position2"></div>
                                <div class="parking-space" id="container-space-position3"></div>
                                <div class="parking-space" id="container-space-position4"></div>
                                <div class="parking-space" id="container-space-position5"></div>
                            </div>
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position6"></div>
                                <div class="parking-space" id="container-space-position7"></div>
                                <div class="parking-space" id="container-space-position8"></div>
                                <div class="parking-space" id="container-space-position9"></div>
                                <div class="parking-space" id="container-space-position10"></div>
                            </div>
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position11"></div>
                                <div class="parking-space" id="container-space-position12"></div>
                                <div class="parking-space" id="container-space-position13"></div>
                                <div class="parking-space" id="container-space-position14"></div>
                                <div class="parking-space" id="container-space-position15"></div>
                            </div>
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position16"></div>
                                <div class="parking-space" id="container-space-position17"></div>
                                <div class="parking-space" id="container-space-position18"></div>
                                <div class="parking-space" id="container-space-position19"></div>
                                <div class="parking-space" id="container-space-position20"></div>
                            </div>
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position21"></div>
                                <div class="parking-space" id="container-space-position22"></div>
                                <div class="parking-space" id="container-space-position23"></div>
                                <div class="parking-space" id="container-space-position24"></div>
                                <div class="parking-space" id="container-space-position25"></div>
                            </div>
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position26"></div>
                                <div class="parking-space" id="container-space-position27"></div>
                                <div class="parking-space" id="container-space-position28"></div>
                                <div class="parking-space" id="container-space-position29"></div>
                                <div class="parking-space" id="container-space-position30"></div>
                            </div>
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position31"></div>
                                <div class="parking-space" id="container-space-position32"></div>
                                <div class="parking-space" id="container-space-position33"></div>
                                <div class="parking-space" id="container-space-position34"></div>
                                <div class="parking-space" id="container-space-position35"></div>
                            </div>
                            <div class="parking-row">
                                <div class="parking-space" id="container-space-position36"></div>
                                <div class="parking-space" id="container-space-position37"></div>
                                <div class="parking-space" id="container-space-position38"></div>
                                <div class="parking-space" id="container-space-position39"></div>
                                <div class="parking-space" id="container-space-position40"></div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Trailer Area -->
                    <div class="bottom-sectors">
                        <div class="trailer-area">
                            <div class="sector-title">TRAILER (<span class="total">10</span>/<span class="occupied-count">0</span>)</div>
                            <div class="parking-area">
                                <div class="parking-space" id="trailer-space-position1"></div>
                                <div class="parking-space" id="trailer-space-position2"></div>
                                <div class="parking-space" id="trailer-space-position3"></div>
                                <div class="parking-space" id="trailer-space-position4"></div>
                                <div class="parking-space" id="trailer-space-position5"></div>
                                <div class="parking-space" id="trailer-space-position6"></div>
                                <div class="parking-space" id="trailer-space-position7"></div>
                                <div class="parking-space" id="trailer-space-position8"></div>
                                <div class="parking-space" id="trailer-space-position9"></div>
                                <div class="parking-space" id="trailer-space-position10"></div>
                            </div>
                        </div>
                
                        <!-- Chassis Area -->
                        <div class="chassis-area">
                            <div class="sector-title">CHASSIS (<span class="total">20</span>/<span class="occupied-count">0</span>)</div>
                            <div class="parking-area">
                                <div class="parking-space" id="chassis-space-position1"></div>
                                <div class="parking-space" id="chassis-space-position2"></div>
                                <div class="parking-space" id="chassis-space-position3"></div>
                                <div class="parking-space" id="chassis-space-position4"></div>
                                <div class="parking-space" id="chassis-space-position5"></div>
                                <div class="parking-space" id="chassis-space-position6"></div>
                                <div class="parking-space" id="chassis-space-position7"></div>
                                <div class="parking-space" id="chassis-space-position8"></div>
                                <div class="parking-space" id="chassis-space-position9"></div>
                                <div class="parking-space" id="chassis-space-position10"></div>
                                <div class="parking-space" id="chassis-space-position11"></div>
                                <div class="parking-space" id="chassis-space-position12"></div>
                                <div class="parking-space" id="chassis-space-position13"></div>
                                <div class="parking-space" id="chassis-space-position14"></div>
                                <div class="parking-space" id="chassis-space-position15"></div>
                                <div class="parking-space" id="chassis-space-position16"></div>
                                <div class="parking-space" id="chassis-space-position17"></div>
                                <div class="parking-space" id="chassis-space-position18"></div>
                                <div class="parking-space" id="chassis-space-position19"></div>
                                <div class="parking-space" id="chassis-space-position20"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        {% comment %} 
        const yardOptions = {
            LA: ["LA00", "LA01", "LA02"],
            PHX: ["PHX00", "PHX01", "PHX02"],
            HOU: ["HOU00", "HOU01", "HOU02"],
            SAV: ["SAV00", "SAV01", "SAV02"],
            MOB: ["MOB00", "MOB01", "MOB02"]
        }; {% endcomment %}
    
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        function setTimelineEvent() {
            // Timeline 클릭 이벤트 추가
            const timelineItems = document.querySelectorAll('.timeline div');
            const modal = document.getElementById('equipmentModal');
            const modalContent = document.getElementById('modalContent');
            
            timelineItems.forEach(item => {
                item.addEventListener('click', () => {
                    const [time, equipment_type, equipment_id, status] = item.textContent.split(' / ');
                    const user = "Unknown"; // 임시로 Unknown으로 설정
                    // 모달 내용 업데이트
                    modalContent.innerHTML = `
                        <div class="modal-body">
                            <div class="equipment-image">
                                Equipment Image
                            </div>
                            <div class="equipment-details">
                                <div class="info-row">
                                    <span class="info-label">Equipment ID:</span>
                                    <span>${equipment_id}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Status:</span>
                                    <span>${status}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Time:</span>
                                    <span>${time}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Type:</span>
                                    <span>${equipment_type}</span>
                                </div>
                                    <div class="info-row">
                                    <span class="info-label">Driver:</span>
                                    <span>${user}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    modal.style.display = 'block';
                });
            });
            
            // 모달 닫기 기능
            const closeBtn = document.querySelector('.close-btn');
            closeBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', (event) => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
            
            // 장비 타입 판별 함수 (예시)
            function getEquipmentType(id) {
                const prefix = id.substring(0, 2);
                switch(prefix) {
                    case 'AA':
                        return 'Container';
                    case 'AB':
                        return 'Trailer';
                    case 'BC':
                        return 'Chassis';
                    default:
                        return 'Unknown';
                }
            }
        }
        // 페이지 로드 시 초기화
        window.onload = function () {
            updateDivision("LA"); // 기본 divisionName으로 호출
        }

        async function updateYard() {
            const selectedYardId = document.getElementById("yard-select").value;
            try {
                // GET 요청, queryString으로 division_name 전달
                const response = await fetch(`/view/transactions/yard/?yard_id=${encodeURIComponent(selectedYardId)}`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken') // CSRF Token 설정
                    }
                });
                // 응답 처리
                if (response.ok) {
                    const data = await response.json();
                    const timelineContainer = document.getElementById('transactions');
                    timelineContainer.innerHTML = ''; // 기존 내용 초기화
                    
                    // 데이터를 기반으로 타임라인 항목을 동적으로 추가
                     data.transactions.forEach(item => {
                        const timelineItem = document.createElement('div');
                        timelineItem.textContent = `${item.movement_time} / ${item.equipment_type} / ${item.truck_id} / ${item.type}`;
                        timelineContainer.appendChild(timelineItem);
                    });
                    setTimelineEvent();
                }
            } catch (error) {
                console.error("Error:", error);
            } 

            try {
                // GET 요청, queryString으로 division_name 전달
                const response = await fetch(`/view/transactions/equipments/?yard_id=${encodeURIComponent(selectedYardId)}`, {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken') // CSRF Token 설정
                    }
                });
                // 응답 처리
                if (response.ok) {
                    const data = await response.json();
                    console.log("data", data);
                } 
            } catch (error) {
                console.error("Error:", error);
            } 
        }

        async function updateDivision(division_name) {
            var divisionName = "";
            if(division_name == null){
                divisionName = document.getElementById("division-select").value;
            }
            else{
                divisionName = division_name;
            }

            document.getElementById("division-select").value;
            const yardSelect = document.getElementById("yard-select");
            try {
                // POST 요청
                const response = await fetch('/view/transactions/yard/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken') // CSRF Token 설정
                    },
                    body: new URLSearchParams({
                        division_name: divisionName // 파라미터로 전달
                    })
                });

                // 응답 처리
                if (response.ok) {
                    const data = await response.json();
                    const yardList = data.yard_ids; // 백엔드에서 반환된 yard_ids 리스트
                    const yardSelect = document.getElementById("yard-select");
                    yardSelect.innerHTML = ""; // 기존 옵션 초기화
        
                    if (yardList.length === 0) {
                        const defaultOption = document.createElement("option");
                        defaultOption.value = "";
                        defaultOption.textContent = "No yards available";
                        defaultOption.disabled = true;
                        defaultOption.selected = true;
                        yardSelect.appendChild(defaultOption);
                        return;
                    }
        
                    // 새로운 옵션 추가
                    yardList.forEach(yardId => {
                        const option = document.createElement("option");
                        option.value = yardId;
                        option.textContent = yardId;
                        yardSelect.appendChild(option);
                    });

                    updateYard();
                }
            } catch (error) {
                console.error("Error:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            function generateCells(containerSelector, count) {
                const container = document.querySelector(containerSelector);
                let occupiedCount = 0;
                
                const titleSpan = container.querySelector('.sector-title .occupied-count');
                
                for (let i = 1; i <= count; i++) {
                    const cell = document.createElement('div');
                    const isOccupied = Math.random() > 0.5;
                    if (isOccupied) {
                        cell.className = 'grid-cell occupied';
                        occupiedCount++;
                    } else {
                        cell.className = 'grid-cell';
                    }
                    cell.textContent = i;
                    container.appendChild(cell);
                }
                
                if (titleSpan) {
                    titleSpan.textContent = occupiedCount;
                }
            }
            function generateParking() {
                let occupiedCount = 0;
                const verticalSpaces = document.querySelectorAll('.parking-column .parking-space');
                const horizontalSpaces = document.querySelectorAll('.parking-column2 .parking-space2');
                const titleSpan = document.querySelector('.left-area .sector-title .occupied-count');
                
                // 왼쪽 상단 세로열: 1-5 (아래에서 위로)
                const leftTopSpaces = Array.from(verticalSpaces).slice(0, 5);
                leftTopSpaces.forEach((space, index) => {
                    const number = 5 - index;  // 5부터 1까지
                    space.textContent = number;
                    const isOccupied = Math.random() > 0.5;
                    if (isOccupied) {
                        space.classList.add('occupied');
                        occupiedCount++;
                    }
                });
                
                // 상단 가로열: 6-10 (왼쪽에서 오른쪽으로)
                const topSpaces = Array.from(horizontalSpaces).slice(0, 5);
                topSpaces.forEach((space, index) => {
                    const number = index + 6;  // 6부터 10까지
                    space.textContent = number;
                    const isOccupied = Math.random() > 0.5;
                    if (isOccupied) {
                        space.classList.add('occupied');
                        occupiedCount++;
                    }
                });
                
                // 오른쪽 상단 세로열: 11-15 (위에서 아래로)
                const rightTopSpaces = Array.from(verticalSpaces).slice(5, 10);
                rightTopSpaces.forEach((space, index) => {
                    const number = index + 11;  // 11부터 15까지
                    space.textContent = number;
                    const isOccupied = Math.random() > 0.5;
                    if (isOccupied) {
                        space.classList.add('occupied');
                        occupiedCount++;
                    }
                });
                
                // 오른쪽 하단 세로열: 26-30 (아래에서 위로)
                const rightBottomSpaces = Array.from(verticalSpaces).slice(15);  // slice(15)로 수정
                rightBottomSpaces.forEach((space, index) => {
                    const number = index + 16;  // 30부터 26까지
                    space.textContent = number;
                    const isOccupied = Math.random() > 0.5;
                    if (isOccupied) {
                        space.classList.add('occupied');
                        occupiedCount++;
                    }
                });
                
                // 하단 가로열: 21-25 (오른쪽에서 왼쪽으로)
                const bottomSpaces = Array.from(horizontalSpaces).slice(5);
                bottomSpaces.forEach((space, index) => {
                    const number = 25 - index;  // 25부터 21까지
                    space.textContent = number;
                    const isOccupied = Math.random() > 0.5;
                    if (isOccupied) {
                        space.classList.add('occupied');
                        occupiedCount++;
                    }
                });
                
                // 왼쪽 하단 세로열: 26-30 (아래에서 위로)
                // 왼쪽 하단 세로열: 16-20 (위에서 아래로)
                const leftBottomSpaces = Array.from(verticalSpaces).slice(10, 15);  // slice(10, 15)로 수정
                leftBottomSpaces.forEach((space, index) => {
                    const number = 30 - index;  // 16부터 20까지
                    space.textContent = number;
                    const isOccupied = Math.random() > 0.5;
                    if (isOccupied) {
                        space.classList.add('occupied');
                        occupiedCount++;
                    }
                });
                
                if (titleSpan) {
                    titleSpan.textContent = occupiedCount;
                }
            }

            generateCells('.container-area', 40);
            generateCells('.trailer-area', 10);
            generateCells('.chassis-area', 20);
            generateParking();
        });

        /* JavaScript에 추가할 코드 */
        const datePicker = document.getElementById('date-picker');
        const currentTime = document.getElementById('current-time');
    
        // 오늘 날짜를 가져오는 함수
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // 초기 설정: 오늘 날짜를 기본값으로 설정하고 max 속성 설정
        const today = getTodayDate();
        datePicker.value = today;
        datePicker.max = today; // 미래 날짜 선택 제한
    
        // 날짜 변경 이벤트
        datePicker.addEventListener('change', function() {
            const selectedDate = new Date(this.value + 'T00:00:00'); // 시간을 00:00:00으로 통일
            const today = new Date(getTodayDate() + 'T00:00:00'); // 시간을 00:00:00으로 통일
            
            if (selectedDate.getTime() === today.getTime()) {
                currentTime.style.display = 'block';
                updateTime();
            } else {
                currentTime.style.display = 'none';
            }
        });
    
        // 시간 업데이트 함수
        function updateTime() {
            const selectedDate = new Date(datePicker.value + 'T00:00:00');
            const today = new Date(getTodayDate() + 'T00:00:00');
            
            if (selectedDate.getTime() === today.getTime()) {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                currentTime.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }

        // 초기 시간 설정 및 업데이트
        updateTime();
        const timeInterval = setInterval(updateTime, 1000);

        function generateCells(containerSelector, count) {
            const container = document.querySelector(containerSelector);
            let occupiedCount = 0;
            
            const titleSpan = container.querySelector('.sector-title .occupied-count');
            
            // Equipment type specific data
            const containerData = {
                ids: ['ABCU1234567', 'BICU7654321', 'CMAU2468135'],
                sizes: ['40ST', '40HC', '20ST', '45HC'],
                types: ['DRY', 'REEFER', 'FLAT RACK', 'ISO TANK', 'OPEN TOP', 'TRI DOOR']
            };
            
            const trailerData = {
                ids: ['TRLU123456', 'TRAU654321', 'TRBU246813'],
                sizes: ["53'", "48'"]
            };
            
            const chassisData = {
                ids: ['CHSS', 'CHSA', 'CHSB'],
                types: ['Regular', 'Light', 'Tandem', 'Tri Axle']
            };
            
            function getRandomElement(array) {
                return array[Math.floor(Math.random() * array.length)];
            }
            
            for (let i = 1; i <= count; i++) {
                const cell = document.createElement('div');
                const isOccupied = Math.random() > 0.5;
                if (isOccupied) {
                    cell.className = 'grid-cell occupied';
                    occupiedCount++;
                    
                    // Add click event and equipment data
                    cell.addEventListener('click', () => {
                        const equipmentModal = document.getElementById('equipmentModal');
                        const modalContent = document.getElementById('modalContent');
                        
                        let modalHTML = '<div class="modal-body">';
                        
                        if (containerSelector.includes('container')) {
                            const id = getRandomElement(containerData.ids);
                            modalHTML += `
                                <h3>Container Information</h3>
                                <div class="info-grid">
                                    <span class="info-label">Location:</span>
                                    <span class="info-value">Position ${i}</span>
                                    <span class="info-label">ID:</span>
                                    <span class="info-value">${id}</span>
                                    <span class="info-label">Size:</span>
                                    <span class="info-value">${getRandomElement(containerData.sizes)}</span>
                                    <span class="info-label">Type:</span>
                                    <span class="info-value">${getRandomElement(containerData.types)}</span>
                                </div>
                            `;
                        } else if (containerSelector.includes('trailer')) {
                            const id = getRandomElement(trailerData.ids);
                            modalHTML += `
                                <h3>Trailer Information</h3>
                                <div class="info-grid">
                                    <span class="info-label">Location:</span>
                                    <span class="info-value">Position ${i}</span>
                                    <span class="info-label">ID:</span>
                                    <span class="info-value">${id}</span>
                                    <span class="info-label">Size:</span>
                                    <span class="info-value">${getRandomElement(trailerData.sizes)}</span>
                                </div>
                            `;
                        } else if (containerSelector.includes('chassis')) {
                            const id = getRandomElement(chassisData.ids);
                            modalHTML += `
                                <h3>Chassis Information</h3>
                                <div class="info-grid">
                                    <span class="info-label">Location:</span>
                                    <span class="info-value">Position ${i}</span>
                                    <span class="info-label">ID:</span>
                                    <span class="info-value">${id}</span>
                                    <span class="info-label">Type:</span>
                                    <span class="info-value">${getRandomElement(chassisData.types)}</span>
                                </div>
                            `;
                        }
                        
                        modalHTML += '</div>';
                        modalContent.innerHTML = modalHTML;
                        equipmentModal.style.display = 'block';
                    });
                } else {
                    cell.className = 'grid-cell';
                }
                cell.textContent = i;
                container.appendChild(cell);
            }
            
            if (titleSpan) {
                titleSpan.textContent = occupiedCount;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            function generateCells(containerSelector, count) {
                const container = document.querySelector(containerSelector);
                let occupiedCount = 0;
                
                // Store the sector title before clearing
                const sectorTitle = container.querySelector('.sector-title');
                const titleSpan = sectorTitle.querySelector('.occupied-count');
                
                // Clear container content except the sector title
                while (container.lastChild) {
                    if (container.lastChild === sectorTitle) {
                        break;
                    }
                    container.removeChild(container.lastChild);
                }
                
                const containerData = {
                    ids: ['ABCU1234567', 'BICU7654321', 'CMAU2468135', 'TEMU1234567', 'MSCU7654321'],
                    sizes: ['40ST', '40HC', '20ST', '45HC'],
                    types: ['DRY', 'REEFER', 'FLAT RACK', 'ISO TANK', 'OPEN TOP', 'TRI DOOR']
                };
                
                const trailerData = {
                    ids: ['TRLU123456', 'TRAU654321', 'TRBU246813', 'TRCU123456', 'TRDU654321'],
                    sizes: ["53'", "48'"]
                };
                
                const chassisData = {
                    ids: ['CHSS', 'CHSA', 'CHSB', 'CHSC', 'CHSD'],
                    types: ['Regular', 'Light', 'Tandem', 'Tri Axle']
                };
                
                function getRandomElement(array) {
                    return array[Math.floor(Math.random() * array.length)];
                }
                
                for (let i = 1; i <= count; i++) {
                    const cell = document.createElement('div');
                    const isOccupied = Math.random() > 0.5;
                    
                    if (isOccupied) {
                        cell.className = 'grid-cell occupied';
                        occupiedCount++;
                        
                        cell.addEventListener('click', function() {
                            const modal = document.getElementById('equipmentModal');
                            const modalContent = document.getElementById('modalContent');
                            const selectedYard = document.getElementById('yard-select').value;
                            
                            let content = '<div class="modal-body">';
                            
                            if (containerSelector.includes('container')) {
                                const id = getRandomElement(containerData.ids);
                                content += `
                                    <h3>Container Information</h3>
                                    <div class="info-grid">
                                        <span class="info-label">Location:</span>
                                        <span class="info-value">${selectedYard}/${i.toString().padStart(2, '0')}</span>
                                        <span class="info-label">ID:</span>
                                        <span class="info-value">${id}</span>
                                        <span class="info-label">Size:</span>
                                        <span class="info-value">${getRandomElement(containerData.sizes)}</span>
                                        <span class="info-label">Type:</span>
                                        <span class="info-value">${getRandomElement(containerData.types)}</span>
                                    </div>
                                `;
                            } else if (containerSelector.includes('trailer')) {
                                const id = getRandomElement(trailerData.ids);
                                content += `
                                    <h3>Trailer Information</h3>
                                    <div class="info-grid">
                                        <span class="info-label">Location:</span>
                                        <span class="info-value">${selectedYard}/${i.toString().padStart(2, '0')}</span>
                                        <span class="info-label">ID:</span>
                                        <span class="info-value">${id}</span>
                                        <span class="info-label">Size:</span>
                                        <span class="info-value">${getRandomElement(trailerData.sizes)}</span>
                                    </div>
                                `;
                            } else if (containerSelector.includes('chassis')) {
                                const id = getRandomElement(chassisData.ids);
                                content += `
                                    <h3>Chassis Information</h3>
                                    <div class="info-grid">
                                        <span class="info-label">Location:</span>
                                        <span class="info-value">${selectedYard}/${i.toString().padStart(2, '0')}</span>
                                        <span class="info-label">ID:</span>
                                        <span class="info-value">${id}</span>
                                        <span class="info-label">Type:</span>
                                        <span class="info-value">${getRandomElement(chassisData.types)}</span>
                                    </div>
                                `;
                            }
                            
                            content += '</div>';
                            modalContent.innerHTML = content;
                            modal.style.display = 'block';
                        });
                    } else {
                        cell.className = 'grid-cell';
                    }
                    
                    cell.textContent = i;
                    container.appendChild(cell);
                }
                
                if (titleSpan) {
                    titleSpan.textContent = occupiedCount;
                }
            }

            // Initial generation
            generateCells('.container-area', 40);
            generateCells('.trailer-area', 10);
            generateCells('.chassis-area', 20);

            // Regenerate cells when yard selection changes
            document.getElementById('yard-select').addEventListener('change', function() {
                generateCells('.container-area', 40);
                generateCells('.trailer-area', 10);
                generateCells('.chassis-area', 20);
            });

            // Modal close functionality
            const modal = document.getElementById('equipmentModal');
            const closeBtn = document.querySelector('.close-btn');
            
            closeBtn.onclick = function() {
                modal.style.display = "none";
            }
            
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        });
    </script>

    <div id="equipmentModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Equipment Information</h2>
            <div id="modalContent"></div>
        </div>
    </div>

    <div id="timelineModal" class="timeline-modal">
        <div class="timeline-modal-content">
            <div class="timeline-modal-header">
                <div class="timeline-modal-title"></div>
                <span class="timeline-close-btn">&times;</span>
            </div>
            <div class="timeline-list"></div>
        </div>
    </div>
</body>
</html>