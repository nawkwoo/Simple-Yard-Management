{% block content %}
<h1>트랜잭션 목록</h1>

<!-- 선택된 야드의 장비 상태 -->
<h2>현재 선택된 야드: {{ selected_yard_name }}</h2>
<div class="equipment-status">
    {% for status in inventory_status %}
    <div class="equipment-section">
        <h3>{{ status.equipment_type }}</h3>
        <div class="capacity-bar">
            {% for i in status.capacity_range %}
            <div class="capacity-block {% if i < status.current_count %}filled{% else %}empty{% endif %}"></div>
            {% endfor %}
        </div>
        <p>{{ status.current_count }} / {{ status.capacity }}</p>
    </div>
    {% endfor %}
</div>

<!-- CSS -->
<style>
    .capacity-bar {
        display: flex;
        gap: 2px;
        margin: 10px 0;
    }
    .capacity-block {
        width: 20px;
        height: 20px;
        border: 1px solid #ccc;
    }
    .capacity-block.filled {
        background-color: green;
    }
    .capacity-block.empty {
        background-color: #f0f0f0;
    }
    .equipment-section {
        margin-bottom: 20px;
    }
</style>

<!-- 필터 폼 -->
<form method="get" class="mb-4">
    <div>
        <label for="yard">야드 선택:</label>
        <select name="yard" id="yard" class="form-select">
            <option value="">-- 모든 야드 --</option>
            {% for yard in yards %}
            <option value="{{ yard.id }}" {% if selected_yard == yard.id %}selected{% endif %}>
                {{ yard.yard_id }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="start_date">시작일:</label>
        <input type="date" name="start_date" id="start_date" value="{{ start_date }}" class="form-control">
    </div>
    <div>
        <label for="end_date">종료일:</label>
        <input type="date" name="end_date" id="end_date" value="{{ end_date }}" class="form-control">
    </div>
    <div>
        <label for="serial_number">장비 시리얼 번호:</label>
        <input type="text" name="serial_number" id="serial_number" placeholder="예: T1234" value="{{ serial_number }}" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary mt-2">필터 적용</button>
</form>

<!-- 트랜잭션 목록 -->
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>장비</th>
            <th>출발 야드</th>
            <th>도착 야드</th>
            <th>이동 시간</th>
            <th>세부 정보</th>
        </tr>
    </thead>
    <tbody>
        {% for transaction in transactions %}
        <tr>
            <td>{{ transaction.equipment.serial_number }}</td>
            <td>
                {% if transaction.departure_yard %}
                    {{ transaction.departure_yard.yard_id }}
                {% else %}
                    없음
                {% endif %}
            </td>
            <td>
                {% if transaction.arrival_yard %}
                    {{ transaction.arrival_yard.yard_id }}
                {% else %}
                    없음
                {% endif %}
            </td>
            <td>{{ transaction.movement_time }}</td>
            <td>{{ transaction.details }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- 트랜잭션이 없을 경우 -->
{% if transactions|length == 0 %}
<p class="text-danger">선택된 조건에 해당하는 트랜잭션이 없습니다.</p>
{% endif %}

{% endblock %}